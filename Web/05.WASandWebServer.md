# WEB SERVER and WAS

> 이해를 돕기 위해 → 학원에서 진행한 플젝의 경우 스프링부트의 내장 톰캣을 WAS로 사용하였다!
> 

## **WebServer 와 WAS란?**

---

**정적 페이지(Static Page)와 동적 페이지(Dynamic Page)**

- Static Page : 바뀌지 않는 페이지. 웹서버는 파일 경로 이름을 받고, 경로와 일치하는 자원들을 반환한다. 항상 동일한 페이지를 반환
- Dynamic Page: 인자에 따라 바뀌는 페이지. 인자의 내용에 맞게 동적인 내용들을 반환하며, **웹 서버에 의해 실행되는 프로그램**을 통해 만들어진 결과물이다.

→ 웹.서.버!! (웹 서버에 의해 실행되는 프로그램은 주로 서블릿 등을 말한다)

![webserver-vs-was1.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f08f4b84-05e4-4904-836b-ce80bb3ae186/046737a6-0a20-4313-8efc-0e4c651a4567/webserver-vs-was1.png)

**Webserver**

- 개념적으로 하드웨어와 소프트웨어로 구분된다.
    - 하드웨어: Web 서버가 설치되어 있는 컴퓨터
    - 소프트웨어: 웹 브라우저 클라이언트로부터 HTTP 요청을 받고, 정적인 컨텐츠(html, css 등)를 제공하는 컴퓨터 프로그램
- 기능
    
    : HTTP 프로토콜을 기반으로, 클라이언트의 요청을 서비스하는 기능을 담당한다
    
    요청에 맞게 아래의 두 가지 기능 중 하나를 선택해서 제공한다
    
    - 정적 컨텐츠 제공(WAS 를 거치지 않고 바로 제공)
    - 동적 컨텐츠 제공을 위한 요청 전달(클라이언트→WAS→클라이언트)
- 종류 : Apache, Nginx, IIS…

**WAS(Web Application Server)**

- **동적인 컨텐츠**를 제공하기 위해 만들어진 애플리케이션 서버
- HTTP를 통해 애플리케이션을 수행해주는 **미들웨어**
- WAS는 **웹 컨테이너** 혹은 **서블릿 컨테이너**라고도 불린다.

(여기서 컨테이너란? 

→ JSP, Servlet을 실행시킬 수 있는 소프트웨어. WAS가 JSP, Servlet 구동환경을 제공한다.)

- 역할 : WAS = 웹 서버 + 웹 컨테이너
    
    웹 서버의 기능들을 구조적으로 분리하여 처리(주로 DB 서버와 함께 보안, 스레드 처리, 분산 트랜잭션 등 분산 환경에서 사용)
    
- 기능
    - 프로그램 실행 환경 및 DB 접속 기능 제공
    - 여러 트랜잭션 관리 기능
    - 비즈니스 로직 수행
- 종류 : Tomcat, JBoss …

→ 그렇다면 WAS만 있으면 되지 않나…? 왜 둘을 구분하는 걸까??? 🙄

**웹 서버가 필요한 이유**

웹 서버는 정적 컨텐츠만 처리! → 기능 분배를 통해 서버 부담을 줄임

**WAS가 필요한 이유**

WAS를 통해 요청에 부합하는 데이터를 DB에서 가져와 비즈니스 로직에 맞게 결과를 만들고 제공하면서 자원을 효율적으로 사용 가능

**이 둘 모두가 필요한 이유(WAS만 있으면 되는거 아닌가?)**

만약 WAS가 정적 컨텐츠 요청까지 처리할 경우 부하가 커지고 동적 컨텐츠 처리가 지연되면서 속도가 저하됨 → 페이지 노출 시간이 길어짐

그리고 여러 대의 WAS를 연결지어 사용(로드 밸런싱)하는 것도 가능함!

웹 서버를 앞단에 두고, WAS에 오류가 발생하면 사용자가 이용하지 못하게 막아둔 뒤 재시작하여 해결(사용자는 오류를 느끼지 못하고 이용 가능)

즉, 자원 이용의 효율성 및 장애 극복, 배포 및 유지 보수의 편의성 추구로 웹 서버와 WAS를 분리해서 사용.

헷갈린다면 예시를 보자…

```
사용자 -> 웹 서버 (요청을 Tomcat으로 라우팅) -> WAS (Tomcat A)
                                            -> WAS (Tomcat B) (오류 발생시 토스)
                        
  익숙한 톰캣으로 예를 들자면 위처럼 톰캣 서버가 여러개가 돌아가고 있고,
  그 중 하나가 오류가 난다면 재시작, 그 동안 다른 서버가 요청을 대신처리!
  -> 사용자는 오류를 감지하지 못하고 정상적으로 이용가능.                       
```

**가장 효율적인 방법**

위처럼 웹서버를 WAS 앞에 두고, 필요한 WAS 들을 웹서버에 플러그인 형태로 설정하면 효율적인 분산 처리가 가능하다.

- 웹 서버가 클라이언트이 요청을 받고, 이를 WAS에 보내 관련된 Servelet을 메모리에 올림
- WAS는 web.xml을 참조해 해당 Servlet에 대한 스레드를 생성(스레드 풀 이용)
- 이 때, HTTPServletRequest와 HttpServletResponse 객체를 생성해 Servlet 전달
- 스레드는 Servlet의 service() 메소드를 호출. service() 메소드는 요청에 따라 doGet() 혹은 doPost() 호출)
- doGet() 이나 doPost() 메소드는 인자에 맞게 생성된 동적 페에지를 Response 객체에 담아 WAS에 전달
- WAS는 RESPONSE 객체를 HTTPRESPONSE 형태로 바꿔 웹 서버로 전달
- 생성된 스레드 종료하고, HttpServletRequest 와 HttpServletResponse 객체 제거

---

이거 분명 중요한 거 같은데 내가 헷갈리는 거 같아서 다시 한번 배워보는 코너

**스레드 : 프로세스 내에서 실행되는 가장 작은 실행 단위**

- 프로세스 : 운영체제로부터 자원을 할당받는 프로그램의 실행단위. 브라우저, 게임 등등..
- 스레드 : 한 프로세스 내에서 실행되는 독립적인 작업 흐름. 프로세스는 여러 개의 스레드를 가질 수 있으며, 이 스레드들은 프로세스 내의 자원(메모리 등)을 공유

**스레드풀** : 미리 생성된 스레드들의 모음으로, 새로운 요청이 들어올 때 마다 새로운 스레드를 생성하는 대신, 기존의 스레드를 재사용하여 성능을 최적화

Q. WAS는 웹서버와 웹 컨테이너 역할을 모두 수행할 수 있다. 하지만 웹 서버와 WAS를 각각 사용하는 이유는 무엇인가?