## CSRF(Cross Site Request Forgery)

웹의 취약점 중 하나로, 사용자가 자신의 의지와 관계없이 공격자가 의도한 행위(modify, delete, register 등)를 특정한 웹사이트에  request 하도록 만드는 공격. 즉 유저의 권한을 도용해 중요한 기능을 실행하도록 한다. 

ex) 해커가 사용자의 SNS 계정으로 광고성 글을 올림

→ CSRF는 해커가 pc를 감염시키거나 서버를 해킹해서 공격하는 것이 아닌다.

**CSRF의 공격 조건**

- 사용자가 해커가 만들어 놓은 피싱 사이트에 접속한 경우
- 위조 요청을 전송하는 서비스에 사용자가 로그인을 한 상황

→ 자동로그인의 경우 이런 피싱 사이트에 접속하게 되면서 피해를 입는 경우가 많다. 또한 해커가 XSS 공격을 성공시킨 사이트라면 피싱사이트가 아니더라도 CSRF 공격이 이루어질 수 있다.

**대응기법**

- 리퍼러(Refferer) 검증 : 백엔드 단에서 Refferer 검증을 통해 승인된 도메인으로 요청시에만 처리
- Security Token 사용 : 사용자의 세션에 임의의 난수 값을 저장, 요청시 해당 값을 포함하여전송시킨다. 백엔드 단에서는 요청을 받을 때 세션에 저장된 토큰값과 요청 파라미터로 전달 받는 토큰 값이 일치하는 지 검증 과정을 거치는 방법이다.

하지만 이러한 대응기법들도 XSS에 취약점이 있다면 공격받을 수 있다.

## XSS(Cross Site Scription)

웹의 취약점 중 하나로, 관리자가 아닌 권한이 없는 사용자가 웹 사이트에 스크립트를 삽입하는 공격 기법을 말한다. 악의적으로 스크립트를 삽입하여 이를 열람한 사용자의 쿠키가 해커에게 전송, 이 탈취한 쿠키를 통해 세션 하이재킹 공격을 한다. 해커는 세션 ID를 가진 쿠키로 사용자의 계정에 로그인 하는 방식을 이용한다.

**공격 종류** : 지속성, 반사형, DOM기반 형 등

- 지속성 :  XXS 취약점이 존재하는 웹에 악성 스크립트를 삽입하여 열람한 사용자의 쿠키를 탈취하거나 리다이렉션시키는 공격을 한다. 이때 삽입된 스크립트를 DB에 저장시켜 지속적으로 공격을 하기 때문에 Persistent XSS 라고 불린다.
- 반사형 : 사용자에게 입력 받은 값을 서버에서 되돌려 주는 곳에서 발생. 공격자는 악의적인 스크립트와 함께 URL을 사용자에게 누르도록 유도하고, 누른 사용자는 이 스크립트가 실행되어 공격을 당하게 되는 유형이다.
- DOM 기반: 악성 스크립트가 포함된 URL을 사용자가 요청하게 되면서 브라우저를 해석하는 단계에서 발생하는 공겨이다. 이 스크립트로 인해 클라이언트 측 코드가 원래 의도와 다르게 실행된다. 이는 다른 XSS 공격과 달리 서버 측에서 탐지가 어렵다.

**대응기법**

- 입출력 값 검증 : XSS Cheat Sheet에 대한 필터 목록을 만들어 모든 Cheat Sheet에 대한 대응을 가능하도록 사전에 대배.
- XSS 방어 라이브러리, 확장앱 :  서버단에서 추가. XSS 방어를 지원한다.
- CORS, SOP 설정 : CORS(Cross-Origin Resourece Sharing 교차 출처 리소스 공유), SOP(Same-Origin-Policy 동일 출처 정책)를 통해 리소스의  소스를 제한하는 것이 효과적인 방어 방법이 될 수 있음.

Q. CSRF의 대응기법 중 사용자의 세션에 임의의 난수값을 저장하여 이를 검증함으로써 CSRF 공격을 방어하는 것은?