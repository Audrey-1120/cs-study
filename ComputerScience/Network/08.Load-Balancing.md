# 로드 밸런싱(Load Balancing)

웹사이트에 많은 사람이 접속한다면 네트워크 과부하가 걸릴 수 있다. 대학교에서 수강신청을 하는 경우를 생각해보자. 한 서버에 많은 사람들이 접속해 서버가 터지는 경우가 생기기도 한다.

따라서 많은 사람들에 대해 1대의 서버가 모든 트래픽을 감당하는 것은 힘들다. 이를 위해서는

→ 하드웨어의 성능을 올리기(Scale-up)

→ **여러 대의 서버에게 균등하게 트래픽을 분산시켜주기(Load Balancing)**

## 로드 밸런싱이란?

네트워크 트래픽을 여러 서버에 분산시켜서 하나의 서버에 과부하가 걸리지 않도록 하는 기술이다.

주로 웹 서버, 데이터베이스 서버 등에서 많이 사용된다.

## 로드 밸런싱의 필요성

- **트래픽 관리** : 한 서버에 너무 많은 트래픽이 몰리면 성능이 저하될 수 있다. 그러므로 여러 서버로 분산할 필요가 있다.
- **고가용성** : 한 서버가 다운되더라도 다른 서버가 그 역할을 대신할 수 있어서 서비스가 중단되지 않는다.
- **확장성** : 트래픽이 증가하면 서버를 추가해서 처리량을 늘릴 수 있다.

## 로드 밸런싱의 구성 요소

- **로드 밸런서** : 트래픽을 분산시키는 역할을 함. 서버와 클라이언트 사이에 둔다.
- **서버 풀(Server Pool)** : 트래픽을 처리할 여러 서버들의 집합이다.
- **헬스 체크(Health Check)** : 각 서버의 상태를 주기적으로 확인해서 정상 작동 여부를 판단한다.

## 로드밸런싱의 기법

1. **라운드 로빈 (Round Robin)**
    - 순차적으로 돌아가면서 세션을 할당해준다.
    - 요청이 오면 그 요청을 순서대로 서버에 분배해준다.
        - 예를 들어 세 대의 서버가 있다고 해보자. 첫 번째 요청은 첫번째 서버로,  두 번째 요청은 두번째 서버로, 세번째 요청은 세번째 서버로 감. 네번째 요청은 다시 첫번째 서버로 돌아간다.
    - 로드 밸런싱 대상 서버의 스펙이 동일하며, 처리 시간 혹은 세션 지속 시간이 짧은 애플리케이션의 경우 이 방식이 적합하다.
2. **가중 라운드 로빈 (Weighted Round Robin)**
    - 각 서버마다 가중치를 부여해서 더 높은 성능을 가진 서버가 더 많은 트래픽 처리한다.
        - 특정 서버의 스펙이 좋다면 해당 서버에 가중치를 좀 더 준다. → 세션을 더 많이 할당한다.
        - 스펙이 좋지 않은 서버에는 가중치를 적게 준다. → 세션을 적게 할당한다.
3. **최소 연결 (Least Connection)**
    - 가장 적게 연결(가장 적은 세션)되어 있는 서버에 세션을 할당해준다.
    - 각 서버의 부하를 실시간으로 고려할 수 있으며 불균형한 트래픽을 방지할 수 있다. 그러나 모든 연결을 추적해야해서 약간의 오버헤드가 발생할 수 있다.
4. **최소 응답 (Least Response Time)**
    - 서버의 응답 시간을 고려해서 세션을 할당한다.
    - 가장 짧은 응답 시간을 보이는 서버에 우선적으로 세션을 할당해준다.
    - 사용자에게 더 빠른 응답을 제공할 수 있고, 실시간으로 서버 상태를 반영할 수 있으나, 약간의 오버헤드가 발생할 수 있다.
5. **해시 (Hash)**
    - 클라이언트의 IP 주소나 다른 특정 값을 해시 함수로 변환하여 특정 서버로 트래픽을 전송하는 방식.
        - 예를 들어 클라이언트의 IP 주소를 해시해서 그 결과를 바탕으로 서버를 선택함.
    - 동일한 클라이언트가 항상 같은 서버에 연결되도록 할 수 있다. 특정 IP주소나 포트에서 접속량이 특히 많을 때 관리가 편하다.

## 로드 밸런서 장애 대비

서버를 분배하는 로드 밸런서에 문제가 생길 경우를 대비해 로드 밸런서를 이중화한다.

### Active 상태와 Passive 상태

**Active 상태**

- Active 로드 밸런서는 실제로 트래픽을 처리하고 있는 로드 밸런서를 뜻한다.
- 해당 로드 밸런서는 클라이언트의 요청을 받아서 여러 서버로 트래픽을 분배한다.

**Passive 상태**

- Passive 로드 밸런서는 현재 트래픽을 처리하지 않고 대기 중인 로드 밸런서를 뜻한다.
- Active 로드 밸런서가 정상적으로 작동하고 있는 동안 Passive 로드 밸런서는 대기 상태로 있으면서 Active 로드 밸런서를 모니터링함.
- Active 로드 밸런서가 문제가 생기면 Passive 로드 밸런서가 자동으로 Active 상태로 전환되어 트래픽을 처리함.

---

**참고자료**

[[네트워크] 로드밸런싱(Load Balancing)이란? 종류와 기법](https://habitus92.tistory.com/22)

[2 be week (Load Balancing)](https://velog.io/@cks8483/2-be-week-Load-Balancing)