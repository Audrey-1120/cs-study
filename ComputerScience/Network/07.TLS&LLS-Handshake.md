# TLS/SSL Handshake

## TLS/SSL Handshake란?

HTTPS에서 클라이언트와 서버간 통신을 하기 전에 SSL 인증서로 신뢰성 여부를 판단하기 위해 연결하는 방식이다.

## 진행순서

1. **클라이언트가 인사한다.**
    - 클라이언트는 “Hello, Server!”하고 인사한다. 이 메시지에는 사용하는 암호화 방식, 버전 압축, 방법 등의 정보가 담겨있다.
2. **서버가 답한다.**
    - 서버로 “Hello, Client!”하고 답한다! 이때 서버는 클라이언트가 보낸 암호화 방식과 압축 방법을 받고, 세션 ID와 CA 인증서를 같이 보내준다. 이 인증서에는 서버의 공개키가 들어있다.
3. **클라이언트가 인증서를 확인한다.**
    - 클라이언트는 서버가 보낸 인증서를 확인한다. 신뢰할 수 있는 CA 목록에 있는지 체크한다.
4. **난수 생성하고 암호화한다.**
    - 클라이언트가 난수 바이트를 만들어서 서버의 공개키로 암호화한다. 이 난수는 앞으로 쓸 대칭키를 만드는데 사용한다.
5. **클라이언트 인증서 요청(옵션)**
    - 만약 서버가 클라이언트 인증서를 요구했다면, 클라이언트는 자신의 인증서와 개인키로 암호화된 임의의 바이트 문자열을 함께 보낸다.
6. **서버가 클라이언트 인증서를 확인한다.**
    - 서버는 클라이언트의 인증서를 확인하고, 클라이언트가 보낸 난수 바이트를 자신의 개인키로 복호화해서 대칭키를 생성한다.
7. **클라이언트가 완료 메시지를 전송한다.**
    - 클라이언트는 "Handshake 완료!" 메시지를 보내면서, 지금까지 주고받은 내용을 해싱한 값을 대칭키로 암호화해서 같이 보낸다.
8. **서버도 확인한 후 완료 메시지를 전송한다.**
    - 서버도 동일하게 지금까지 주고받은 내용을 해싱하고, 클라이언트가 보낸 값과 일치하는지 확인한다. 일치하면 서버도 "Handshake 완료!" 메시지를 대칭키로 암호화해서 보낸다.
9. **서로 신뢰하고 통신을 시작한다.**
    - 클라이언트는 서버의 메시지를 대칭키로 복호화한다. 이제 서로 신뢰할 수 있다는 걸 확인했으므로, 앞으로 이 대칭키로 안전하게 데이터를 주고받을 수 있다.