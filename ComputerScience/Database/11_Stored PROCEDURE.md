# 저장 프로시저 (Stored PROCEDURE, SP)

> 일련의 쿼리를 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합

- 원하는 결과물을 얻기 위해 사용할 여러 줄의 쿼리문을 한 번의 요청으로 실행하기 위해  
-> DB 내부에 저장된 일련의 SQL 명령문들을 하나의 함수처럼 실행하기 위한 쿼리의 집합  
-> DB에 대한 작업을 정리한 절차를 RDBMS에 저장한 쿼리 집합 (영구저장모듈)  

- 프로시저를 만들어두면, 애플리케이션에서 여러 상황에 따라 해당 쿼리문이 필요할 떄 인자 값만 전달하여 쉽게 원하는 결과물을 받을 수 있다.

<br>

### 프로시저 생성

```sql
CREATE PROCEDURE 프로시저명 ( 파라미터 )
AS
BEGIN
    쿼리문
END;
```

### 프로시저 호출

```sql
EXEC 프로시저명;
```

<br>

### 프로시저 장점

#### 1. 최적화 & 캐시

프로시저의 최초 실행 시 최적화 상태로 컴파일이 되며, 그 이후 프로시저 캐시(메모리)에 저장된다.  
만약 해당 프로세스가 여러 번 사용될 때, 다시 컴파일 작업을 거치지 않고 캐시에서 가져오게 된다.

#### 2. 유지 보수

작업이 변경될 때, 다른 작업은 건드리지 않고 프로시저 내부에서 수정만 하면 된다.

#### 3. 트래픽 감소

클라이언트가 직접 SQL문을 작성하지 않고, 프로시저명에 매개변수만 담아 전달하면 된다.  
즉, SQL문이 서버에 이미 저장되어 있기 때문에 클라이언트와 서버 간 네트워크 상 트래픽이 감소된다.

#### 4. 보안

프로시저 내에서 참조 중인 테이블의 접근을 막을 수 있다.

<br>

### 프로시저 단점

#### 1. 호환성

구문 규칙이 SQL / PSM 표준과의 호환성이 낮기 때문에 코드 자산으로의 재사용성이 나쁘다.

#### 2. 성능

문자 또는 숫자 연산에서 프로그래밍 언어인 C 나 Java 보다 성능이 느리다.

#### 3. 디버깅

에러가 발생했을 때, 어디서 잘못되었는지 디버깅하는 것이 힘들 수 있다.  
-> 별도의 에러 테이블을 사용한다.

<br>

#### 문제
저장 프로시저의 두번째 실행부터는 ⓐ에 있는 것을 가져와서 사용하므로 속도가 빨라진다. 또한 여러 개의 쿼리를 한 번에 실행할 수 있다.
<br><br>
ⓐ에 들어갈 단어는?

<br>

##### [참고]
[저장 프로시저](<https://eunsun-zizone-zzang.tistory.com/52>)
[프로시저 생성](<https://m.blog.naver.com/seek316/222069811490>)
