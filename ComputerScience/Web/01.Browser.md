# 브라우저 동작 방법

---

> 들어가기에 앞서, 브라우저가 어떻게 동작하는지 간단히 요약된 부분을 먼저 보고 넘어가겠다.
> 

**브라우저의 동작**

- 주소창에 url 입력 → 서버에 요청이 전송
- 해당 페이지에 존재하는 여러 자원(text, image…)들이 보내진다
- 이제 브라우저는 전송된 html과 css를 W3C 명세에 따라 해석한다(→**렌더링 엔진**)
- 렌더링 엔진은 우선 html 파서로 html을 파싱(문서를 분석하며 DOM 트리를 구축)한다.
- 그리고 css파서로 css 파싱(css정보를 스타일 구조체로 생성)을 시작한다.
- 이 두가지(html 파싱, css파싱)를 연결시켜 렌더 트리를 만든다. 이를 통해 문서가 시각적 요소를 포함한 형태로 구성된 상태가 된다.
- 화면에 배치를 시작하고,  UI 백엔드가 노드를 돌며 형상을 그린다.
- 이때 빠른 화면 로딩를 위해 ‘배치와 그리는 과정’은 페이지의 모든 정보가 전송될 때까지 기다리지 않고 진행한다. 자원을 전송받으면, 기다리는 동시에 일부분 먼저 진행하고 화면에 표시한다. (먼저 되는 부분이 먼저 뜬다는 것)

→ 이제 이 과정들에 대해 좀 더 세세히 알아보겠다.

---

## 브라우저의 주요 기능

: 브라우저는 사용자가 선택한 자원을 서버에 요청하고, 이를 브라우저에 표시한다.

자원은 html 문서나 pdf, image 등 다양한 형태이며, 자원의 주소는 URI에 의해 정해진다.

브라우저는 html과 css 명세에 따라 html 파일을 해석해서 표시한다.  → 이 ‘명세’란 웹 표준화 기구인 W3C(World Wide Web Consortium)에서 정해진다.

(과거에는 표준명세를 따르지 않는 부분들이 많아 호환성 문제가 많았다)

브라우저가 가진 인터페이스는 홈버튼, 새로고침버튼, 북마크, 주소표시줄, 이전/다음버튼 등 있다. 보통 유저친화적으로 비슷비슷하게 수렴하게 된 인터페이스를 갖는다. 

---

## 브라우저 기본 구조

![web1.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f08f4b84-05e4-4904-836b-ce80bb3ae186/35a16bf5-cfce-438f-b7e3-0acb259fe04f/web1.png)

**사용자 인터페이스**

주소 표시줄, 홈버튼 등 사용자가 활용하는 서비스(요청페이지를 제외한 나머지 부분)

**브라우저 엔진**

사용자 인터페이스와 렌더링 엔진 사이의 동작 제어

**렌더링 엔진**

요청한 콘텐츠 표시(html 요청 → html, css 파싱 후 화면 표시)

**통신**

http 요청과 같은 네트워크 호출에 사용(플랫폼으로붙어 독립적인 인터페이스로 구성)

**자바스크립트 해석기**

자바스크립트 코드를 해석하고 실행

**UI 백엔드**

플랫폼에서 명시하지 않은 일반적 인터페이스. 콤보박스 창처럼 기본적인 장치를 그림

**자료저장소**

쿠키 등 모든 종류의 자원을 하드 디스크에 저장하는 계층

---

## 렌더링

: 렌더링 엔진은 요청 받은 내용을 브라우저 화면에 표시한다. 기본적으로 html, xml, 이미지를 표시할 수 있으며 추가적인 확장을 통해 pdf 등 다른 유형도 표시가 가능하다.

**렌더링 엔진 종류**

- 크롬, 사파리 : 웹킷(Webkit) 엔진 사용
- 파이어폭스 : 게코(Gecko) 엔진 사용

→ **웹킷(Webkit) :**  최초 리눅스 플랫폼에 동작하기 위한 오픈소스 엔진(애플이 맥과 윈도우에서 사파리 브라우저를 지원하기 위해 수정을 더함)

**렌더링 동작 과정**

1. DOM 트리 구축을 위한 HTML 파싱
2. 렌더 트리 구축
3. 렌더 트리 배치
4. 렌더 트리 그리기

```
//예시

먼저 html 문서를 파싱한다.

-> 콘텐츠 트리 내부에서 태그를 모두 DOM 노드로 변환한다.

-> 외부 css 파일과 함께 포함된 스타일 요소를 파싱한다.

(스타일 정보와 html 표시 규칙)-> 렌더 트리 생성

이렇게 생성된 렌더 트리는 정해진 순서대로 화면에 표시되는데, 
생성 과정이 끝났을 때 배치가 진행되면서 
노드가 화면의 정확한 위치에 표시되는 것을 의미

이후에 UI 백엔드에서 렌더 트리의 각 노드를 가로지으며 
형상을 만드는 그리기 과정이 진행된다.

이러한 과정이 점진적으로 진행되며, 렌더링 엔진은 좀더 빠르게 
사용자에게 제공하기 위해 모든 html을 파싱할 때까지 기다리지 않고 
배치와 그리기 과정을 시작한다. 
-> 즉, 전송을 받고 기다리는 동시에 전송받은 내용을 먼저 화면에 출
```

**DOM 이란?**

문서객체모델(Document Object Model)

: <html>, <body> 같은 태그들을 javascript가 활용할 수 있는 객체로 만든 것

Dom은 웹브라우저가 html 페이지를 인식하는 방식을 말한다. (아래 트리구조 참고)

**웹킷 동작 구조**

![helloworld-59361-3.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f08f4b84-05e4-4904-836b-ce80bb3ae186/e13a14c7-2261-4feb-8088-a04e2c8f0613/helloworld-59361-3.png)

어태치먼트란? 웹킷이 렌더 트리를 생성하기 위해 DOM 노드와 스타일 정보를 연결하는 과정

---

## 파싱(Parsing)과 DOM 트리 구축

파싱(Pasrsing): 여기서 파싱은 문서 파싱으로 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미

→ 문서를 가지고 어휘와 구문을 분석하여 파싱 트리를 구축한다. 이는 어휘분석기를 통해 언어의 구문 규칙에 따라 문서 구조 분석이 이루어지며, 이 과정에서 구문 규칙과 일치하는 지 비교하고, 일치하는 노드만 파싱 트리에 추가시킨다. (끝까지 규칙이 맞지 않는 부분은 구문 오류가 포함되어 있다는 것)

이러한 컴파일 과정을 거쳐, 다시 기계코드 문자로 변환시키는 과정까지 완료되면 최종 결과물이 출력된다. 보통 이런 파서를 생성하는 것은 복잡하고 최적화가 힘든 과정이기에, 자동으로 생성해주는 파서생성기를 많이 활용한다.

(웹킷은 플렉스(flex)나 바이슨(bison)을 이용하여 유용하게 파싱이 가능)

만약 <head> 태그를 실수로 빠뜨려도, 파서가 돌면서 오류를 수정해준다.(head 객체를 암묵적으로 만들어준다. )

→ 결국 이 파싱 과정을 통해 서버로부터 받은 문서를 브라우저가 이해하고 사용할 수 있는 DOM 트리구조로 변환

Q. 렌더링 엔진은 크게 2가지 (  ) 와 (  ) 를 파싱하는 역할을 한다. 옳은 것은?

1. DOM, CSS
2. DOM, JavaScript
3. CSS, HTML