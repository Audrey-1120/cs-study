# 프로세스 & 스레드

블로그마다 기술면접 때 단골 질문이라고 나옵니다 !!!  
-> **프로세스와 스레드 차이**
-> **프로그램이 작동하는 방식** (운영체제가 시스템 자원을 어떤 방식으로 할당하고, 실제 프로그램은 이 자원을 어떤 방식으로 활용하여 작동되는지)

> 프로세스 : 운영체제로부터 자원을 할당받은 **작업의 단위**  
> 스레드 : 프로세스가 할당받은 자원을 이용하는 **실행 흐름의 단위**

### 프로그램

- 컴퓨터에서 실행할 수 있는 파일 (파일을 실행하지 않은 상태 -> 정적 프로그램이라고도 한다.)

- 파일이 저장 장치에 저장되어 있지만 **메모리에는 올라가 있지 않은 정적인 상태**
    - **메모리에 올라가 있지 않다는 것**은 아직 운영체제가 프로그램에게 독립적인 메모리 공간을 할당해주지 않았다는 것이다.

<br>

### 프로그램 → 프로세스 과정

프로그램을 실행하는 순간 해당 파일은 컴퓨터 메모리에 올라가게 된다. -> **동적인 상태**가 된다.

이러한 <u>동적인 상태가 된 프로그램</u>을 **프로세스**라고 한다.
<u>실행되고 있는 컴퓨터 프로그램</u>이라고도 한다.

<img src="https://velog.velcdn.com/images%2Fraejoonee%2Fpost%2F467686bc-b53e-44d7-a0ac-6bd0372f1714%2F101.png"><br>

### 프로세스 한계로 인한 스레드 탄생 과정

과거에는 프로그램을 실행하면 실행 시작부터 실행 끝까지 프로세스 하나만을 사용했다고 한다. 하지만 점차 프로그램이 복잡해지면서 프로세스 하나만으로 프로그램을 실행하기엔 한계가 있었다.

그러면 동일한 프로그램을 여러 개 프로세스로 처리하면 되지 않을까?하고 생각할 수도 있지만, 그만큼 메모리를 더 차지하고 CPU에서 할당받는 자원이 중복되게 된다.  
(운영체제는 안전성을 위해 프로세스마다 자신에게 할당된 메모리 내의 정보에만 접근할 수 있도록 제약을 두어, 이를 벗어나는 정보에 접근하려면 오류가 발생할 수 있다.)

그래서 **프로세스 내에서 더 작은 실행 단위인 <u>스레드</u>를 만들어, 동시에 진행될 수 있도록 하였다.**

(예를 들면, 크롬 브라우저(프로세스)에서 파일을 다운 받으면서 검색하고 게임을 하는 경우(각각 스레드))

<img src="https://velog.velcdn.com/images%2Fraejoonee%2Fpost%2F6f274681-dfa7-45eb-9121-2cc9f4b972a5%2F102.png"><br>

### 스레드

> 하나의 프로세스 내에서 동시에 진행되는 작업 갈래, 흐름의 단위
> 프로세스의 코드에 정의된 절차에 따라 실행되는 특정한 수행 경로

- 프로세스와 다르게 스레드들끼리 메모리를 공유하며 작동한다. 그러면서 프로세스 실행 흐름의 일부가 된다.
    - 코드로 비유하면, 스레드는 코드 내에 선언된 함수들이 되어 main 함수 또한 일종의 스레드라고 볼 수 있다.

- 하나의 프로그램은 하나 이상의 프로세스를 가지고 있고, 하나의 프로세스는 반드시 하나 이상의 스레드를 갖는다.
    - 프로세스를 생성하면, 기본적으로 하나의 main 스레드가 생성된다.

- 하나의 프로세스 안에 여러 개의 스레드들이 들어 있다.
    - 스레드 수가 많을 수록 프로그램 속도도 증가한다.

<hr>

### 프로세스의 자원 구조

프로그램이 실행되면 운영체제는 프로세스마다 각각 독립된 메모리 영역(주소 공간)을 `Code / Data / Stack / Heap`의 형식으로 할당해준다.

각각 독립된 메모리 영역을 할당 받기 때문에 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없다.

- 코드 영역 (Code / Text)  
CPU가 해석 가능한 기계어 형태로 저장된 프로그램 함수들의 코드가 있는 메모리 영역

- 데이터 영역 (Data)  
코드가 실행되면서 사용하는 전역 변수, 정적 변수, 배열 등 각종 데이터가 있는 영역 (아래와 같이 3가지로 세분화된다.)

    - .data : 초기화된 전역 변수 또는 static 변수 등 프로그램이 사용하는 데이터를 저장
    - .BSS : 초기화되지 않은 전역 변수, static 변수가 저장
    - .rodata : const 같은 상수 키워드 선언된 변수나 문자열 상수가 저장

- 힙 영역 (Heap)  
생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 영역  
사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다.

- 스택 영역 (Stack)  
지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 영역 (임시 메모리 영역)  
함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.

<img src="https://velog.velcdn.com/images%2Fraejoonee%2Fpost%2Fb7939911-f3e8-48ac-abb8-63d8a17d0444%2F103.png"><br>

코드 영역 (Code / Text) & 데이터 영역 (Data) : 선언할 때 그 크기가 결정되는 정적 영역  
힙 영역 (Heap) & 스택 영역 (Stack) : 프로세스가 실행되는 동안 **크기가 늘어났다 줄어들기도 하는 동적 영역** (크기 변화가 있어 힙과 스택 사이에 화살표가 표시된 그림도 있다.)

### 스레드의 자원 공유

<img src="https://velog.velcdn.com/images%2Fraejoonee%2Fpost%2Fb91490ed-c67b-407d-8fea-a8d6fdb22559%2F104.png"><br>

스레드는 스택 영역만 할당 받아 복사하고 나머지 영역들을 프로세스 내의 다른 스레드들과 공유된다. 그러면 자원의 생성과 관리의 중복성이 최소화되어 수행 능력이 올라가게 된다.

독립적인 스택을 가진다는 것 -> 독립적인 함수 호출 가능 -> **독립적인 실행 흐름 추가되는 것**

<br>

### 정리하자면

- 프로세스 : 자신만의 고유 공간과 자원을 할당받아 사용
- 스레드 : 다른 스레드와 공간과 자원을 공유하면서 사용

<hr>

### 멀티 프로세스

> 하나의 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것

- 장점 : 안전성(메모리 침범 문제를 OS 차원에서 해결)  
- 단점 : 각각 독립된 메모리 영역을 가지고 있어, 작업량이 많을 수록 오버헤드가 발생한다. Context Switching으로 인한 성능 저하

### Context Switching

> 프로세스의 상태 정보를 저장하고 복원하는 일련의 과정

즉, 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태를 보관하고, 대기하고 있던 다음 순번의 프로세스가 동작하면서, 이전에 보관했던 프로세스 상태를 복구하는 과정

프로세스는 각 독립된 메모리 영역을 할당 받아 사용되기 때문에, 캐시 메모리 초기화와 같은 무거운 작업이 진행되었을 때 오버헤드가 발생하는 문제가 존재한다.

### 멀티 스레드

> 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해준다.

- 장점
    - 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소한다
    - 전역 변수와 정적 변수에 대한 자료 공유가 가능하다.

- 단점
    - 안전성 문제
    - 하나의 스레드가 데이터 공간에 문제를 일으키면, 모든 스레드가 작동 불능 상태가 된다.(공유 메모리를 가지기 때문에) -> **동기화 문제**

- 안전성 문제는 Critical Section 기법을 통해 대비한다.
    - 하나의 스레드가 공유 데이터 값을 변경하는 시점에 다른 스레드가 그 값을 읽으려할 때 발생하는 문제를 해결하기 위한 동기화 과정

    - 상호 배제, 진행, 한정된 대기를 충족해야 한다.


<br>

#### 문제 1
ⓐ : 운영체제로부터 자원을 할당받은 **작업의 단위**  
ⓑ : 프로세스가 할당받은 자원을 이용하는 **실행 흐름의 단위**

#### 문제 2
ⓐ : 선언할 때 그 크기가 결정되는 정적 영역  
ⓑ : 프로세스가 실행되는 동안 **크기가 늘어났다 줄어들기도 하는 동적 영역**

    1) ⓐ - 힙 영역 (Heap) & 스택 영역 (Stack), ⓑ - 코드 영역 (Code / Text) & 데이터 영역 (Data)
    2) ⓐ - 코드 영역 (Code / Text) & 데이터 영역 (Data), ⓑ - 힙 영역 (Heap) & 스택 영역 (Stack)

<br>

##### [참고]
[프로세스 vs 스레드 개념](<https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4>)

[(면접 관련) 프로세스와 스레드의 차이](<https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4>)

[멀티 프로세스 vs 멀티 스레드 비교](<https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread>)
